# ุชูุฑูุฑ ุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (LLM) ูู ุงูุจูุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุงูุจูุช ูุณุชุฎุฏู **ุงุณุชุฑุงุชูุฌูุฉ ูุฌููุฉ** ุชุฌูุน ุจูู:
1. **ุงูุฑุฏูุฏ ุงููุจุงุดุฑุฉ** (Direct Responses) - ุจุฏูู LLM (ุฃุณุฑุน ูุฃุฑุฎุต)
2. **ุงูุฐูุงุก ุงูุงุตุทูุงุนู** (LLM) - ููุฑุฏูุฏ ุงููุนูุฏุฉ ูุงูุฐููุฉ

---

## โ ุงูุญุงูุงุช ุงูุชู **ูุง** ุชุณุชุฎุฏู LLM (ุฑุฏูุฏ ูุจุงุดุฑุฉ)

### 1. **ุงูุชุญูุงุช ูุงููุฏุงุน** (Fast Intents)
- `greeting` (ููุงุ ุฃููุงูุ ูุฑุญุจุง)
- `thanks` (ุดูุฑุงูุ ูุดููุฑ)
- `goodbye` (ูุน ุงูุณูุงูุฉุ ุจุงู)

**ุงููููุน:** `core/agent.py` - `FAST_INTENTS`
```python
FAST_INTENTS = {"greeting", "thanks", "goodbye"}
# ุฑุฏูุฏ ุซุงุจุชุฉ ูุจุงุดุฑุฉ ุจุฏูู LLM
```

### 2. **ูุนูููุงุช ุงูุฏูุงู** (`hours`)
- "ูุชู ุชูุชุญููุ"
- "ูุชู ุงููุงุช ุงูุฏูุงูุ"

**ุงููููุน:** `core/router.py` - ุฎุท 165-188
- ูุฌูุจ ุงูุจูุงูุงุช ูู Google Sheets ูุจุงุดุฑุฉ
- ููุณููุง ูู ูุงุฆูุฉ ุจุฏูู LLM

### 3. **ูุนูููุงุช ุงูุชูุงุตู** (`contact`)
- "ูููููุ"
- "ููู ุฃุชูุงุตู ูุนููุ"

**ุงููููุน:** `core/router.py` - ุฎุท 200-229
- ูุฌูุจ ุจูุงูุงุช ุงููุฑูุน ูู Google Sheets
- ููุณููุง ูุจุงุดุฑุฉ

### 4. **ุงูุฑุฏูุฏ ุงููุจุงุดุฑุฉ ููุฃุทุจุงุก/ุงูุฎุฏูุงุช/ุงููุฑูุน** (`doctor`, `service`, `branch`)
**ุงููููุน:** `core/router.py` - `_respond_directly()` (ุฎุท 337-514)

**ุดุฑูุท ุงูุงุณุชุฎุฏุงู:**
- ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ููุฌูุฏุฉ ูู Google Sheets
- ุฅุฐุง ูุงู ุงูุณุคุงู ุจุณูุท (ูุซู: "ููู ุงูุฃุทุจุงุกุ" ุฃู "ุงุจู ุทุจูุจ ุนุธุงู")

**ูุซุงู:**
- "ููู ุงูุฃุทุจุงุกุ" โ ูุงุฆูุฉ ูุจุงุดุฑุฉ ูู ุงูุจูุงูุงุช
- "ุงุจู ุทุจูุจ ุนุธุงู" โ ููุชุฑุฉ ูุจุงุดุฑุฉ ุญุณุจ ุงูุชุฎุตุต
- "ุงูุฏูุชูุฑุฉ ุณุงุฑุฉ ุจ ุงู ูุฑุนุ" โ ุจุญุซ ูุจุงุดุฑ ูู ุงูุจูุงูุงุช

### 5. **FAQ ุจุณูุท** (`faq`)
- ุฅุฐุง ูู ูุญุชูู ุนูู "ููู" ุฃู "ุทุฑููุฉ" ุฃู "ุฎุทูุงุช"
- ุฑุฏ ุซุงุจุช: "ุนุฐุฑุงูุ ูุง ูุฏุฑุช ุฃููู ุณุคุงูู..."

**ุงููููุน:** `core/router.py` - ุฎุท 231-237

### 6. **ุงูุญุฌุฒ** (`booking`)
- ุนูููุฉ ุงูุญุฌุฒ ุชุณุชุฎุฏู **State Machine** (ุขูุฉ ุญุงูุงุช)
- ูู ุฎุทูุฉ ูู ุงูุญุฌุฒ (ุงูุงุณูุ ุงูุฌูุงูุ ุงูุฎุฏูุฉ...) โ ุฑุฏ ูุจุงุดุฑ ูู `core/formatter.py`
- **ูุง ูุณุชุฎุฏู LLM** ูู ุนูููุฉ ุงูุญุฌุฒ ููุณูุง

**ุงููููุน:** `core/booking.py` + `core/formatter.py`

---

## ๐ค ุงูุญุงูุงุช ุงูุชู **ุชุณุชุฎุฏู LLM**

### 1. **ุชุตููู ุงูููุงูุง** (Intent Classification)
**ุงููููุน:** `core/intent.py` - `classify()`

**ูุชู ูุณุชุฎุฏู LLM:**
- ุฅุฐุง ูู ูุชู ุงูุชุนุฑู ุนูู ุงูููุฉ ูู ุงููุญูุตุงุช ุงูุณุฑูุนุฉ (greeting, thanks, goodbye, doctor patterns)
- ูุณุชุฎุฏู **GPT-4o-mini** ูุน Structured Outputs

**ุงููุงุด:** ูุนู (5 ุฏูุงุฆู TTL) - ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ูุชุดุงุจูุฉุ ูุนูุฏ ุงููุชูุฌุฉ ูู ุงููุงุด

### 2. **ุงูุฑุฏูุฏ ุงูุฐููุฉ** (Agent Responses)
**ุงููููุน:** `core/agent.py` - `generate_response()`

**ูุชู ูุณุชุฎุฏู LLM:**

#### ุฃ) **ุนูุฏูุง `_respond_directly()` ูุง ูุนูุฏ ุฑุฏ:**
- ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ
- ุฅุฐุง ูุงู ุงูุณุคุงู ูุนูุฏ (ูุซู: "ูู ุฎุจุฑุฉ ุงูุฏูุชูุฑ ููุณูุ")
- ุฅุฐุง ูุงู ุงูุณุคุงู ูุญุชุงุฌ ุชูุณูุฑ ุฃู ุตูุงุบุฉ ุฐููุฉ

#### ุจ) **ุงูุฃููุงุน ุงูุชุงููุฉ:**
- `greeting` - ููู ููุท ุฅุฐุง ูู ููู ูู `FAST_INTENTS` (ูุงุฏุฑ)
- `doctor` - ุฅุฐุง ูุงู ุงูุณุคุงู ูุนูุฏ ุฃู ูุญุชุงุฌ ุชูุณูุฑ
- `service` - ุฅุฐุง ูุงู ุงูุณุคุงู ูุนูุฏ ุฃู ูุญุชุงุฌ ุชูุณูุฑ
- `branch` - ุฅุฐุง ูุงู ุงูุณุคุงู ูุนูุฏ ุฃู ูุญุชุงุฌ ุชูุณูุฑ
- `general` - ุฃุณุฆูุฉ ุนุงูุฉ ุชุญุชุงุฌ ููู ุฐูู
- `faq` - ุฅุฐุง ูุงู ุงูุณุคุงู ูุญุชูู ุนูู "ููู" ุฃู "ุทุฑููุฉ" ุฃู "ุฎุทูุงุช"
- `booking` - ุฅุฐุง ูุงู ุงูุณุคุงู ุนู ุงูุญุฌุฒ (ูููุณ ุทูุจ ุญุฌุฒ ุตุฑูุญ)
- `unclear` - ุฅุฐุง ูุงูุช ุงูููุฉ ุบูุฑ ูุงุถุญุฉ

**ุงููุงุด:** ูุนู (120 ุซุงููุฉ TTL) - ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ + ุงูููุฉ + ุงูููุงูุงุช ูุชุดุงุจูุฉ

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูุงุณุชุฎุฏุงู ุงููุชููุนุฉ

### ุจุฏูู LLM (ุฑุฏูุฏ ูุจุงุดุฑุฉ):
- โ ุงูุชุญูุงุช/ุงูุดูุฑ/ุงููุฏุงุน: **100%**
- โ ุงูุฏูุงู: **100%**
- โ ุงูุชูุงุตู: **100%**
- โ ููุงุฆู ุงูุฃุทุจุงุก/ุงูุฎุฏูุงุช/ุงููุฑูุน (ุจุณูุทุฉ): **~70%**
- โ ุงูุญุฌุฒ (State Machine): **100%**

### ูุน LLM:
- ๐ค ุชุตููู ุงูููุงูุง: **~30-40%** (ุงูุจุงูู ูู ุงููุญูุตุงุช ุงูุณุฑูุนุฉ)
- ๐ค ุฑุฏูุฏ Agent: **~30%** (ุงูุจุงูู ูู `_respond_directly`)

**ุงููุชูุฌุฉ:** ุงูุจูุช ูุณุชุฎุฏู LLM ูู **~30-40%** ูู ุงูุญุงูุงุช ููุทุ ููุง ูููู ุงูุชูููุฉ ูุงูููุช.

---

## ๐ ุงูุชุฏูู ุงููุงูู

```
1. ุงููุณุชุฎุฏู ูุฑุณู ุฑุณุงูุฉ
   โ
2. Intent Classification (core/intent.py)
   โโ ูุญุต ุณุฑูุน (greeting, thanks, goodbye, doctor patterns)
   โ  โโ ุฅุฐุง ููุฌุฏ โ ููุฉ ูุจุงุดุฑุฉ (ุจุฏูู LLM)
   โโ ุฅุฐุง ูู ูููุฌุฏ โ LLM (GPT-4o-mini) ููุชุตููู
   โ
3. Router (core/router.py)
   โโ ุฅุฐุง booking โ State Machine (ุจุฏูู LLM)
   โโ ุฅุฐุง hours/contact โ ุฑุฏ ูุจุงุดุฑ (ุจุฏูู LLM)
   โโ ุฅุฐุง doctor/service/branch โ _respond_directly()
   โ  โโ ุฅุฐุง ููุฌุฏ ุฑุฏ โ ุฅุฑุฌุงุน ูุจุงุดุฑ (ุจุฏูู LLM)
   โ  โโ ุฅุฐุง ูู ูููุฌุฏ โ LLM (Agent)
   โโ ุจุงูู ุงูุญุงูุงุช โ LLM (Agent)
   โ
4. Agent (core/agent.py)
   โโ ูุญุต ุงููุงุด ุฃููุงู
   โโ ุฅุฐุง FAST_INTENT โ ุฑุฏ ูุจุงุดุฑ (ุจุฏูู LLM)
   โโ ุฅุฐุง ูู ููู ูู ุงููุงุด ุฃู FAST_INTENT โ LLM (GPT-4o-mini)
   โ
5. ุฅุฑุฌุงุน ุงูุฑุฏ ูููุณุชุฎุฏู
```

---

## ๐ก ุชุญุณููุงุช ุงูุฃุฏุงุก

### 1. **ุงููุงุด (Caching)**
- **Intent Cache:** 5 ุฏูุงุฆู TTL (500 ุฑุณุงูุฉ)
- **Agent Cache:** 120 ุซุงููุฉ TTL (300 ุฑุฏ)

### 2. **ุงูุฑุฏูุฏ ุงููุจุงุดุฑุฉ**
- **FAST_INTENTS:** ุจุฏูู LLM
- **Direct Responses:** ุจุฏูู LLM ููุฃุทุจุงุก/ุงูุฎุฏูุงุช/ุงููุฑูุน ุงูุจุณูุทุฉ
- **State Machine:** ุจุฏูู LLM ููุญุฌุฒ

### 3. **ุชูููู ุญุฌู Context**
- ูุง ูุฑุณู ุจูุงูุงุช ููู LLM ูู `greeting`, `thanks`, `goodbye`
- ูุญุฏุฏ ุงูููุงุฆู ุจู 12 ุนูุตุฑ ูุญุฏ ุฃูุตู
- ูุฑุณู ููุท ุงูุจูุงูุงุช ุงููุทููุจุฉ ุญุณุจ ุงูููุฉ

---

## ๐ ููุฎุต

| ุงูุญุงูุฉ | ุงุณุชุฎุฏุงู LLM | ุงูุณุจุจ |
|--------|-------------|--------|
| ุงูุชุญูุงุช/ุงูุดูุฑ/ุงููุฏุงุน | โ ูุง | ุฑุฏูุฏ ุซุงุจุชุฉ ูุจุงุดุฑุฉ |
| ุงูุฏูุงู | โ ูุง | ุจูุงูุงุช ูุจุงุดุฑุฉ ูู Google Sheets |
| ุงูุชูุงุตู | โ ูุง | ุจูุงูุงุช ูุจุงุดุฑุฉ ูู Google Sheets |
| ููุงุฆู ุจุณูุทุฉ (ุฃุทุจุงุก/ุฎุฏูุงุช/ูุฑูุน) | โ ูุง | ููุชุฑุฉ ูุจุงุดุฑุฉ ูู ุงูุจูุงูุงุช |
| ุงูุญุฌุฒ (State Machine) | โ ูุง | ุฑุฏูุฏ ุซุงุจุชุฉ ูู formatter |
| ุชุตููู ุงูููุงูุง (ูุนูุฏ) | โ ูุนู | GPT-4o-mini |
| ุฑุฏูุฏ ุฐููุฉ (ูุนูุฏุฉ) | โ ูุนู | GPT-4o-mini |
| ุฃุณุฆูุฉ ุนุงูุฉ/FAQ | โ ูุนู | ูุญุชุงุฌ ููู ุฐูู |

**ุงููุชูุฌุฉ:** ุงูุจูุช **ุฐูู** ููู **ุงูุชุตุงุฏู** - ูุณุชุฎุฏู LLM ููุท ุนูุฏูุง ูุญุชุงุฌ ูุนูุงู.

